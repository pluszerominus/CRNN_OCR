# CRNN_OCR

# **Задача**
1) Классифицировать изображения на два класса: изображение с рукописным текстом и с печатным
2) Распознать текст с изображения и вывести его в текстовом виде

# **Датасет**

Датасет содержит в себе изображения с текстом и csv файл, в котором для каждого изображения приведён текст с картинки и тип текста (рукописный или печатный)

**Примеры**

img1.jpeg
<div align="center">
  
![img1](https://github.com/user-attachments/assets/3d7480c3-5b2e-4f7b-9490-a3b2860bc72b)

</div>

img2.png
<div align="center">
  
![img2](https://github.com/user-attachments/assets/0c177ccb-041b-4810-b90d-7d91091a876c)

</div>

<div align="center">

File name | Text | Class |
--- | --- | --- |
img1.jpeg | ая его. С другой стороны-черная страшная туча, которую прорывали в разных местах пе | 1 |
img2.png | часть земли | 0 |

</div>

Суммарно датасет содержит более 120 000 тысяч изображений

# Предобработка 

Для предобработки был написан отдельный модуль, который содержит 6 функций
1. Изменение размера: стандартно до размером (128, 512)
2. Использование адаптивного порогового значения
3. Поворот изображения на 90 градусов по часовой стрелки (для задачи OCR)
4. Использование предыдущих функций
5. Кодирование одного предложения (для задачи OCR)
6. Кодирование всего датасета (для задачи OCR)

**Блок-схема предобработки данных для задачи классификации**
<div align="center">
  
![image](https://github.com/user-attachments/assets/2e248ed6-654a-4b6b-99ce-35887d415c71)

</div>

В результате предобработки получаются чёрно-белое изображения размером (128,512)

**Примеры обработки для классификации**

<div align="center">
  
![image](https://github.com/user-attachments/assets/9f4cc841-43d0-4903-8b8d-9e1cc813d525)

![image](https://github.com/user-attachments/assets/5944f790-c81d-43b6-82ec-8b915b69ce24)

</div>

**Блок-схема предобработки данных для задачи OCR**

<div align="center">

![image](https://github.com/user-attachments/assets/958c4a3b-1f82-4ee6-8f90-06700e1201ec)

</div>

**Пример обработки для задачи OCR**

<div align="center">

![image](https://github.com/user-attachments/assets/7fe0e0dd-fcaf-4979-aa12-49eca685e4e3)

![image](https://github.com/user-attachments/assets/718c22ae-3cf0-467f-ae2e-66172394a3eb)

</div>

Исходный текст | Закодированный текст |
--- | --- |
ьным требованиям плавности дорожного по | 43, 29, 42, 28,  0, 34, 32, 21, 17, 30, 18, 16, 29, 24, 45, 28,  0, 31, 27, 16, 18, 29, 30, 33, 34, 24,  0, 20, 30, 32, 30, 22, 29, 30, 19, 30,  0, 31, 30, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47 |



# **Классификация**

Для задачм классификации была реализована модель с двумя блоками
1) Блок кодировщика, состоящий из свёрточных блоков
2) Блок классификации, состоящий из полносвязных слоёв

**Блок схема модели**

![class](https://github.com/user-attachments/assets/26ba58da-5b03-4cb0-8f50-4cff8c8bca50)

Данная архитектура позволяет кодировать изображения в скрытое пространство, в котором и производится классификация. Скрытое пространство позволяет выделить признаки, которые лучше всего описывают входные изображения

Обучение модели проходило на 10 эпохах, так как количество данных достаточно большое и модель не слишком сложная, 10 эпох было достаточно, чтобы не достичь переобучения и получить хорошие результаты

**График ошибки и точности модели**

<div align="center">

![image](https://github.com/user-attachments/assets/59dca864-f423-4e01-917d-d182292c1e30)

</div>

В результате обучения модель достигла точности в 99 % 

# **Задача OCR**

Для задачи OCR использовалась модель CRNN, которая состоит из трёх блоков
1) Блок формирования признаков из входного изображения. Состоит из нескольких подблоков(Свёрточный слой + Слой пулинга + Слой нормализации)
2) Блок обработки сформированных признаков. Состоит из двух двуноправленных LSTM слоёв
3) Формирование 

**Архитектура модели**
<div align="center">

![image](https://github.com/user-attachments/assets/d271ae0b-3c34-4373-aa42-c162dfb60f7c)

</div>

Модель обучалась 20 эпох на 70 000 изображений.

<div align="center">

![image](https://github.com/user-attachments/assets/0e8c3ce1-7058-44f0-b939-429592fd9bb3)

</div>

Минимальная ошибка - 6.36. Доля ошибочных символов(CER метрика) состявляет - 2.4 %

После 14 эпохи модель вышла на плато, поэтому дальнейшее обучение не имеет смысла


# **Результаты работы модели**
Распознавание символов (текст слева - исходный текст, текст справа - предсказание модели)

<div align="center">

![image](https://github.com/user-attachments/assets/aa20806a-c53c-4281-8d7e-cdc49387cd98)

![image](https://github.com/user-attachments/assets/e2aaf405-23a9-4d44-a8c2-822b756c1480)

![image](https://github.com/user-attachments/assets/920053d7-7d83-43db-a7a6-b816fefe862b)

![image](https://github.com/user-attachments/assets/13b901bc-d26f-4b43-a08c-2498485f9bc0)

</div>






